<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<h1>to do list of user {{user.username}}</h1>
<form action="{%url 'add-task' user.id %}" method="post">
    {%csrf_token%}
    <div class="block">
        <label>task</label>
        <input type="text" name = "task" placeholder="task" >
    </div>
    <div class="block">
        <label>priority</label>
        <input type="number" min="0" max="10" name="priority"> 
    </div>
    <button type="submit">add task</button>
</form>
{% if items.count > 0 %}
    <ul>
        {% for i in items %}
        <li class = "changes">
            <div class="block" id = "item_{{i.pk}}">
                <input type="checkbox" class = "is_done" >{{i.item_text}}
                <input type="number" min="0" max="10" class= "priority"  value="{{i.item_prio}}">
            </div>
        </li>
        {% endfor %}
        <button onclick="save_changes()">save</button>
    </ul>
{% endif %}
<script>
    axios.defaults.xsrfCookieName = 'csrftoken'
    axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
    function save_changes(){
        submission = [];
        items = $(".changes .block");
        for(var i = 0; i <items.length;i++){
            item = items[i];
            id = item.id.split("_")[1];
            is_done = item.getElementsByClassName("is_done")[0].checked;
            item.getElementsByClassName("is_done")[0].checked = false;
            priority = item.getElementsByClassName("priority")[0].value;
            submission[i] = {id:id,is_done:is_done,priority:priority};
        }
        axios
        .post("{%url 'save-tasks' %}",{data:submission})
        .then(function(){
            location.reload()
        });
    }
</script>